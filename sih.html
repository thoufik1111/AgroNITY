<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AgroNity - Smart Crop & Input Management System</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
<style>
  :root{
    --bg:#0b0f12; --card:#0f1517; --muted:#9bdfb5; --accent:#00ffa3;
    --panel-gap:18px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background:var(--bg); color:#e9fff6;
  }

  /* LOGIN full-screen */
  #loginScreen{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6));
    z-index:40;
  }
  .loginCard{
    width:420px; background:#061017; border-radius:12px; padding:20px; border:1px solid rgba(255,255,255,0.03);
    box-shadow:0 6px 30px rgba(0,0,0,0.7);
  }
  .loginCard h2{margin:0 0 8px 0; color:var(--accent)}
  .loginCard p{margin:0 0 16px 0; color:#9dbfb0; font-size:14px}
  .field{display:flex; flex-direction:column; gap:6px; margin-bottom:12px}
  input[type="text"], input[type="password"], input[type="number"]{
    padding:10px; border-radius:8px; border:1px solid #123; background:transparent; color:#eafff4;
  }
  .btn{cursor:pointer; padding:10px 12px; border-radius:8px; border:none}
  .btn-primary{background:linear-gradient(90deg,var(--accent),#00d4ff); color:#012; font-weight:700}
  .btn-ghost{background:transparent; border:1px solid rgba(255,255,255,0.06); color:#bfffe3}

  /* HEADER */
  header{ display:flex; justify-content:space-between; align-items:center; padding:14px 22px; background:#071018; border-bottom:1px solid rgba(255,255,255,0.02)}
  .brand{font-weight:800; color:var(--accent); font-size:20px}
  .subtitle{color:#9dbfb0; font-size:13px; margin-left:8px}
  .header-right{display:flex; gap:10px; align-items:center}

  /* GRID LAYOUT */
  .mainGrid{
    display:grid; grid-template-columns: 2fr 1fr; gap:var(--panel-gap); padding:18px; align-items:stretch; height:calc(100vh - 68px);
  }

  /* LEFT */
  #leftPanel{ display:flex; flex-direction:column; gap:14px }
  .card{ background:var(--card); border-radius:12px; padding:14px; border:1px solid rgba(255,255,255,0.02); }

  /* farm inputs */
  .inputs{ display:flex; gap:10px; flex-wrap:wrap; align-items:center }
  select, input[type="number"], input[type="text"]{
    background:#0f1517; color:#ecfff7; border:1px solid rgba(255,255,255,0.08); border-radius:8px; padding:8px 10px; min-width:120px;
  }
  option{ background:#0f1517; color:#e9fff6; } /* fix dropdown visibility */

  /* chat area */
  #chatCard{ display:flex; flex-direction:column; flex:1; min-height:0 }
  .chatWindow{ flex:1; overflow:auto; padding:12px; border-radius:10px; background:rgba(0,0,0,0.16) }
  .msg { max-width:78%; padding:8px 10px; border-radius:10px; margin:8px 0; white-space:pre-line; line-height:1.35 }
  .msg.user{ margin-left:auto; background:#062a1f; color:#e8fff2 }
  .msg.bot{ margin-right:auto; background:#071019; color:#dfffee }

  .chatControls{ display:flex; gap:8px; align-items:center; margin-top:10px }
  #chatInp{ flex:1; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:#eafff8 }

  .smallBtn{ padding:8px 10px; border-radius:8px; border:none; cursor:pointer }
  .btn-img{ background:var(--accent); color:#002; }
  .btn-voice{ background:#ff3fcf; color:white }
  .btn-send{ background:#00d4ff; color:#002; font-weight:700 }

  /* RIGHT PANEL */
  #rightPanel{ display:flex; flex-direction:column; gap:14px }
  #chips{ display:flex; flex-direction:column; gap:8px }
  .chip{ display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:rgba(0,0,0,0.12) }
  .chip.on{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,255,163,0.03) }

  #chartCard{ flex:1; display:flex; flex-direction:column; padding:12px; border-radius:10px; background:rgba(0,0,0,0.08) }
  canvas{ width:100% !important; height:230px !important; }

  /* Budget Advice Section */
  #budgetAdviceCard{ padding:14px; border-radius:12px; background:var(--card); border:1px solid rgba(255,255,255,0.02); }
  .budget-inputs{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; align-items:center; }
  .budget-inputs input{ flex:1; min-width:120px; }
  #getBudgetBtn { padding: 8px 12px; }

  #distInfo{ padding:12px; border-radius:8px; background:rgba(0,0,0,0.06) }

  /* footer small note */
  .muted{ color:#97cbb0; font-size:13px }

  @media (max-width:980px){
    .mainGrid{ grid-template-columns: 1fr; height:auto; padding:12px }
    #rightPanel{ order:2 }
    #leftPanel{ order:1 }
    canvas{ height:200px !important }
  }
</style>
</head>
<body>

<!-- LOGIN screen -->
<div id="loginScreen" aria-hidden="false">
  <div class="loginCard">
    <h2>AgroNity</h2>
    <p class="muted">Enter your details to login. (Demo OTP: <strong>2622</strong>)</p>

    <div class="field">
      <label style="color:#9dbfb0">Mobile Number</label>
      <input id="loginMobile" type="text" placeholder="9876543210" />
    </div>
    <div class="field">
      <label style="color:#9dbfb0">Username</label>
      <input id="loginUser" type="text" placeholder="demo" />
    </div>
    <div class="field">
      <label style="color:#9dbfb0">OTP</label>
      <input id="loginOtp" type="number" placeholder="2622" />
    </div>
    <div style="display:flex; gap:8px; justify-content:flex-end;">
      <button class="btn btn-primary" onclick="doLogin()">Login</button>
    </div>
  </div>
</div>

<!-- Header -->
<header>
  <div style="display:flex;align-items:center">
    <div class="brand">AgroNity</div>
    <div class="subtitle">Smart Crop & Input Management System</div>
  </div>
  <div class="header-right">
    <!-- Language Selector Added -->
    <select id="langSel" onchange="changeLang()" style="background:#0f1517;color:#e9fff6;border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:6px 8px;">
      <option value="en">English</option>
      <option value="ta">à®¤à®®à®¿à®´à¯</option>
      <option value="hi">à¤¹à¤¿à¤‚à¤¦à¥€</option>
      <option value="te">à°¤à±†à°²à±à°—à±</option>
      <option value="pa">à¨ªà©°à¨œà¨¾à¨¬à©€</option>
      <option value="ml">à´®à´²à´¯à´¾à´³à´‚</option>
    </select>
    <div id="loggedAs" style="color:#9dbfb0">Not logged</div>
    <button class="btn btn-ghost" onclick="logout()" id="logoutBtn" style="display:none">Logout</button>
  </div>
</header>

<!-- Main app -->
<main class="mainGrid" id="appRoot">
  <!-- LEFT -->
  <section id="leftPanel">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:700;color:var(--accent)" id="farmInputsLbl">Farm Inputs</div>
        <div class="muted" id="farmInputsSub">Select options</div>
      </div>
      <div class="inputs">
        <select id="cropSel" title="Crop"></select>
        <select id="distSel" title="District"></select>
        <input id="landInp" type="number" step="0.25" value="1" title="Area (acre)" />
        <select id="soilSel" title="Soil type"></select>
      </div>
    </div>
    <div style="margin-top:10px; text-align:right">
      <button id="submitBtn" type="button" class="btn btn-primary">Submit</button>
    </div>
    <div id="chatCard" class="card">
      <div style="font-weight:700;color:var(--accent);margin-bottom:8px" id="assistantLbl">Assistant</div>
      <div id="chat" class="chatWindow">
        <div class="muted" id="chatWelcome">Welcome to AgroNity - please login first.</div>
      </div>

      <div class="chatControls">
        <input id="chatInp" type="text" placeholder="Type your question" />
        <input id="fileImg" type="file" accept="image/*" style="display:none" />
        <button class="smallBtn btn-img" onclick="document.getElementById('fileImg').click()">Image</button>
        <button class="smallBtn btn-voice" id="voiceBtn">Voice</button>
        <button class="smallBtn btn-send" onclick="sendText()">Send</button>
      </div>
      <div style="display:flex; gap:8px; margin-top:8px; align-items:center">
        <div class="muted" id="imgPrevLbl">Image preview:</div>
        <div id="imgPreview"></div>
      </div>
    </div>
  </section>

  <!-- RIGHT -->
  <aside id="rightPanel">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700;color:var(--accent)" id="includeLbl">Include in answer</div>
        <div class="muted" id="toggleLbl">Toggle</div>
      </div>
      <div id="chips">
        <div class="chip off"><span id="chipMandi">Mandi Prices</span><button onclick="toggleChip(this)">Off</button></div>
        <div class="chip off"><span id="chipWeather">Weather</span><button onclick="toggleChip(this)">Off</button></div>
        <div class="chip off"><span id="chipPast">Past Reports</span><button onclick="toggleChip(this)">Off</button></div>
        <div class="chip off"><span id="chipGraph">Growth Graph</span><button onclick="toggleChip(this)">Off</button></div>
      </div>
    </div>

    <div id="chartCard" class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:700;color:var(--accent)" id="profitLbl">Profit Trend (Monthly)</div>
        <div class="muted" id="last12Lbl">Prediction for next 12 months</div>
      </div>
      <canvas id="profitChart"></canvas>
    </div>

    <!-- New Budget Advice Section below the chart -->
    <div id="budgetAdviceCard" class="card">
      <div style="font-weight:700; color: var(--accent);">Budget Advice</div>
      <div class="budget-inputs">
        <input type="text" id="budgetCropInp" placeholder="Crop name" title="Crop name">
        <input type="number" id="budgetAreaInp" placeholder="Area (ha)" step="0.1" title="Area in hectares">
        <button id="getBudgetBtn" type="button" class="btn btn-primary smallBtn">Get Advice</button>
      </div>
    </div>
    
    <div id="distInfo" class="card">
      <div style="font-weight:700;color:var(--accent);margin-bottom:6px" id="summaryLbl">Summary</div>
      <div id="distSummary" class="muted">No selection</div>
    </div>
  </aside>
</main>
<script>
   /* Data */
const CROPS = ["Paddy", "Wheat", "Maize", "Cotton", "Groundnut", "Sugarcane", "Tapioca", "Mustard", "Soybean", "Tomato", "Chilli"];
const PUNJAB_DISTRICTS = ["Amritsar", "Barnala", "Bathinda", "Faridkot", "Fatehgarh Sahib", "Fazilka", "Firozpur", "Gurdaspur", "Hoshiarpur", "Jalandhar", "Kapurthala", "Ludhiana", "Malerkotla", "Mansa", "Moga", "Muktsar", "Nawanshahr", "Pathankot", "Patiala", "Rupnagar", "Sahibzada Ajit Singh Nagar", "Sangrur", "Tarn Taran"];
const TN_DISTRICTS = ["Ariyalur", "Chengalpattu", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri", "Dindigul", "Erode", "Kallakurichi", "Kanchipuram", "Kanyakumari", "Karur", "Krishnagiri", "Madurai", "Nagapattinam", "Namakkal", "Nilgiris", "Perambalur", "Pudukkottai", "Ramanathapuram", "Ranipet", "Salem", "Sivagangai", "Tenkasi", "Thanjavur", "Theni", "Thoothukudi", "Tiruchirappalli", "Tirunelveli", "Tirupathur", "Tiruppur", "Tiruvallur", "Tiruvannamalai", "Tiruvarur", "Vellore", "Viluppuram", "Virudhunagar"];
const DISTRICTS = [...PUNJAB_DISTRICTS, ...TN_DISTRICTS];
const SOILS = ["Alluvial", "Red", "Black", "Loamy", "Sandy Loam", "Clayey", "Silty", "Laterite", "Calcareous"];

const DATA = {
Â  Â  // Data for a Punjab district (Ludhiana)
Â  Â  "141001": {
Â  Â  Â  Â  district: "Ludhiana",
Â  Â  Â  Â  rules: {
Â  Â  Â  Â  Â  Â  crop: "Wheat",
Â  Â  Â  Â  Â  Â  fertilizer: "Urea (46% Nitrogen) 70kg/acre",
Â  Â  Â  Â  Â  Â  manure: "Farmyard Manure (FYM) 5 tons/acre",
Â  Â  Â  Â  Â  Â  pesticide: "Chlorpyrifos 200ml/acre",
Â  Â  Â  Â  Â  Â  water: "150L/week"
Â  Â  Â  Â  },
Â  Â  Â  Â  mandi: { commodity: "Wheat", price: 2350, unit: "â‚¹/qtl", date: "2025-09-18" },
Â  Â  Â  Â  weather: { now: "Partly Cloudy 28Â°C", forecast: "Thunderstorm next 3 days" },
Â  Â  Â  Â  past: { last_crop: "Wheat", yield_qtl_per_acre: 30 },
Â  Â  Â  Â  monthly: [{ m: "Jan", val: 120 }, { m: "Feb", val: 125 }, { m: "Mar", val: 128 }, { m: "Apr", val: 135 }, { m: "May", val: 138 }, { m: "Jun", val: 132 }, { m: "Jul", val: 130 }, { m: "Aug", val: 140 }, { m: "Sep", val: 142 }, { m: "Oct", val: 145 }, { m: "Nov", val: 150 }, { m: "Dec", val: 155 }]
Â  Â  },
Â  Â  // Data for a Tamil Nadu district (Chennai)
Â  Â  "600001": {
Â  Â  Â  Â  district: "Chennai",
Â  Â  Â  Â  rules: { crop: "Groundnut", fertilizer: "NPK 75kg/acre", water: "80L/week" },
Â  Â  Â  Â  mandi: { commodity: "Groundnut", price: 3800, unit: "â‚¹/qtl", date: "2025-08-30" },
Â  Â  Â  Â  weather: { now: "Cloudy 30Â°C", forecast: "No heavy rain" },
Â  Â  Â  Â  past: { last_crop: "Groundnut", yield_qtl_per_acre: 10 },
Â  Â  Â  Â  monthly: [{ m: "Jan", val: 90 }, { m: "Feb", val: 95 }, { m: "Mar", val: 98 }, { m: "Apr", val: 110 }, { m: "May", val: 115 }, { m: "Jun", val: 120 }, { m: "Jul", val: 118 }, { m: "Aug", val: 125 }, { m: "Sep", val: 128 }, { m: "Oct", val: 130 }, { m: "Nov", val: 135 }, { m: "Dec", val: 140 }]
Â  Â  }
};

// Disease data for dummy prediction based on keywords
/* Updated diseaseData object */
const diseaseData = {
Â  Â  "wheat": [
Â  Â  Â  Â  "**Wheat Disease Analysis**",
Â  Â  Â  Â  "\n**Fusarium Head Blight:** 84.32% confidence",
Â  Â  Â  Â  "**Leaf Rust:** 71.02% confidence",
Â  Â  Â  Â  "**Healthy:** 5.27% confidence"
Â  Â  ],
Â  Â  "paddy": [
Â  Â  Â  Â  "**Paddy Disease Analysis**",
Â  Â  Â  Â  "\n**Rice Blast:** 92.71% confidence",
Â  Â  Â  Â  "**Brown Spot:** 65.87% confidence",
Â  Â  Â  Â  "**Healthy:** 3.00% confidence"
Â  Â  ],
Â  Â  "tomato": [
Â  Â  Â  Â  "**Tomato Disease Analysis**",
Â  Â  Â  Â  "\n**Late Blight:** 88.21% confidence",
Â  Â  Â  Â  "**Early Blight:** 75.62% confidence",
Â  Â  Â  Â  "**Healthy:** 10.02% confidence"
Â  Â  ],
Â  Â  "maize": [
Â  Â  Â  Â  "**Maize Disease Analysis**",
Â  Â  Â  Â  "\n**Maize Streak Virus:** 80.13% confidence",
Â  Â  Â  Â  "**Northern Corn Leaf Blight:** 75.56% confidence",
Â  Â  Â  Â  "**Gray Leaf Spot:** 48.11% confidence",
Â  Â  Â  Â  "**Healthy:** 12.34% confidence"
Â  Â  ],
Â  Â  "cotton": [
Â  Â  Â  Â  "**Cotton Disease Analysis**",
Â  Â  Â  Â  "\n**Bacterial Blight:** 90.32% confidence",
Â  Â  Â  Â  "**Root Rot:** 85.22% confidence",
Â  Â  Â  Â  "**Verticillium Wilt:** 70.98% confidence",
Â  Â  Â  Â  "**Healthy:** 5.23% confidence"
Â  Â  ],
Â  Â  "tapioca": [
Â  Â  Â  Â  "**Tapioca Disease Analysis**",
Â  Â  Â  Â  "\n**Cassava Mosaic Disease:** 95.73% confidence",
Â  Â  Â  Â  "**Brown Leaf Spot:** 71.11% confidence",
Â  Â  Â  Â  "**Tuber Rot:** 60.43% confidence",
Â  Â  Â  Â  "**Healthy:** 2.43% confidence"
Â  Â  ],
Â  Â  "default": [
Â  Â  Â  Â  "**Disease Analysis of this crop**",
Â  Â  Â  Â  "\n**Bacterial Spot:** 60.44% confidence",
Â  Â  Â  Â  "**Powdery Mildew:** 45.85% confidence",
Â  Â  Â  Â  "**Healthy:** 22.22% confidence"
Â  Â  ]
};
/* populate dropdowns */
CROPS.forEach(c => cropSel.insertAdjacentHTML('beforeend', `<option>${c}</option>`));
DISTRICTS.forEach(d => distSel.insertAdjacentHTML('beforeend', `<option>${d}</option>`));
SOILS.forEach(s => soilSel.insertAdjacentHTML('beforeend', `<option>${s}</option>`));

/* LOGIN */
let loggedIn = false;
function doLogin() {
Â  Â  const mob = document.getElementById('loginMobile').value.trim();
Â  Â  const user = document.getElementById('loginUser').value.trim();
Â  Â  const otp = document.getElementById('loginOtp').value.trim();
Â  Â  if (mob && user && otp === "2622") {
Â  Â  Â  Â  document.getElementById('loginScreen').style.display = 'none';
Â  Â  Â  Â  loggedIn = true;
Â  Â  Â  Â  document.getElementById('loggedAs').textContent = `Logged as ${user}`;
Â  Â  Â  Â  document.getElementById('logoutBtn').style.display = 'inline-block';
Â  Â  Â  Â  initAfterLogin();
Â  Â  } else {
Â  Â  Â  Â  pushMsg('bot', "Invalid login. Use OTP 2622.");
Â  Â  }
}
function sendText() {
Â  Â  const q = chatInp.value.trim();
Â  Â  if (!q) return;
Â  Â  if (!loggedIn) {
Â  Â  Â  Â  pushMsg('bot', "Please login first.");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  pushMsg('user', q);
Â  Â  chatInp.value = '';
Â  Â  setTimeout(() => reply(q), 500);
}
function logout() { location.reload(); }

/* Chart */
const ctx = document.getElementById('profitChart').getContext('2d');
let profitChart = new Chart(ctx, {
Â  Â  type: 'line',
Â  Â  data: { labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], datasets: [{ label: "Profit", data: Array(12).fill(null), tension: 0.35, borderWidth: 2, pointRadius: 4, borderColor: '#00ffa3' }] },
Â  Â  options: { maintainAspectRatio: false, scales: { x: { ticks: { color: '#9bdfb5' } }, y: { ticks: { color: '#9bdfb5' } } }, plugins: { legend: { display: false } } }
});

/* Chat helpers */
function toggleChip(btn) { const chip = btn.parentElement; chip.classList.toggle('on'); chip.classList.toggle('off'); btn.textContent = chip.classList.contains('on') ? "On" : "Off"; }
function chipOn(label) { return [...document.querySelectorAll('#chips .chip')].some(n => n.textContent.includes(label) && n.classList.contains('on')); }
function pushMsg(who, text, isImage = false, imageUrl = null) {
Â  Â  const d = document.createElement('div');
Â  Â  d.className = 'msg ' + (who === 'bot' ? 'bot' : 'user');
Â  Â  if (isImage) {
Â  Â  Â  Â  d.innerHTML = `<img src="${imageUrl}" alt="Uploaded image" class="rounded-md" style="max-width:100%;height:auto;"/>`;
Â  Â  } else {
Â  Â  Â  Â  // Simple markdown-like formatting for bold text
Â  Â  Â  Â  d.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
Â  Â  }
Â  Â  document.getElementById('chat').appendChild(d);
Â  Â  document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
}

function reply(q) {
Â  Â  const qLower = q.toLowerCase();
Â  Â  const pin = "141001"; // Default pincode for demonstration
Â  Â  const d = DATA[pin];
Â  Â  if (!d) {
Â  Â  Â  Â  pushMsg('bot', 'No data for this pincode.');
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  let ans = '';

Â  Â  if (qLower.includes('fertilizer')) {
Â  Â  Â  Â  ans = `Fertilizer recommendation: ${d.rules.fertilizer}`;
Â  Â  } else if (qLower.includes('manure')) {
Â  Â  Â  Â  ans = `Manure recommendation: ${d.rules.manure}`;
Â  Â  } else if (qLower.includes('pesticide')) {
Â  Â  Â  Â  ans = `Pesticide recommendation: ${d.rules.pesticide}`;
Â  Â  } else {
Â  Â  Â  Â  // Default comprehensive reply
Â  Â  Â  Â  ans = `${d.district} - Crop:${d.rules.crop} - Fertilizer:${d.rules.fertilizer} - Manure:${d.rules.manure} - Pesticide:${d.rules.pesticide} - Water:${d.rules.water}`;
Â  Â  }

Â  Â  if (chipOn('Mandi Prices')) ans += `\nMandi: ${d.mandi.price}${d.mandi.unit} (${d.mandi.date})`;
Â  Â  if (chipOn('Weather')) ans += `\nWeather: ${d.weather.now} | Forecast: ${d.weather.forecast}`;
Â  Â  if (chipOn('Past Reports')) ans += `\nLast crop: ${d.past.last_crop} | Yield: ${d.past.yield_qtl_per_acre} qtl/acre`;
Â  Â  if (chipOn('Growth Graph')) { ans += `\nGraph updated.`; updateChartForPin(pin); }
Â  Â  pushMsg('bot', ans);
Â  Â  distSummary.innerHTML = `<strong style="color:var(--accent)">${d.district}</strong><div>Crop:${d.rules.crop}</div><div>Fertilizer:${d.rules.fertilizer}</div><div>Manure:${d.rules.manure}</div><div>Pesticide:${d.rules.pesticide}</div><div>Weather:${d.weather.now}</div>`;
}

function updateChartForPin(pin) { const d = DATA[pin]; if (!d) return; profitChart.data.labels = d.monthly.map(x => x.m); profitChart.data.datasets[0].data = d.monthly.map(x => x.val); profitChart.update(); }
function initAfterLogin() { 
Â  chatWelcome.textContent = "Welcome - ask about fertilizer, weather, mandi, etc."; 
Â  chatInp.addEventListener('keydown', e => { 
Â  Â  if (e.key === 'Enter') sendText(); 
Â  }); 
Â  if (DATA["141001"]) updateChartForPin("141001");
  distSummary.innerHTML += `
    <hr style="border: 0.5px solid var(--muted); margin: 10px 0;">
    <div style="font-weight: bold; margin-bottom: 5px; color: var(--accent);">Chatbot Keywords:</div>
    <div style="font-size: 0.9em;">
      <strong>fertilizer:</strong> It displays the type and amount of fertilizer used for the selected crop.<br>
      <strong>pesticide:</strong> It displays the type and amount of pesticide used for the selected crop.<br>
      <strong>manure:</strong> It displays the type and amount of manure used for the selected crop.<br>
      <strong>guide:</strong> It states the step-by-step approach from cultivation to harvesting.<br>
      <strong>mandi prices:</strong> Shows the current market price.<br>
      <strong>weather:</strong> Gives current weather and forecast.<br>
      <strong>past reports:</strong> Provides past crop and yield data.<br>
      <strong>growth graph:</strong> Updates the monthly profit trend graph.
    </div>
  `;
}

/* Language Translations */
const translations = {
Â  Â  en: {
Â  Â  Â  Â  farmInputsLbl: "Farm Inputs", farmInputsSub: "Select options", assistantLbl: "Assistant",
Â  Â  Â  Â  chatWelcome: "Welcome to AgroNity - please login first.", imgPrevLbl: "Image preview:",
Â  Â  Â  Â  includeLbl: "Include in answer", toggleLbl: "Toggle", chipMandi: "Mandi Prices",
Â  Â  Â  Â  chipWeather: "Weather", chipPast: "Past Reports", chipGraph: "Growth Graph",
Â  Â  Â  Â  profitLbl: "Profit Trend (Monthly)", last12Lbl: "Prediction for next 12 months", summaryLbl: "Summary"
Â  Â  },
Â  Â  ta: {
Â  Â  Â  Â  farmInputsLbl: "à®µà®¿à®µà®šà®¾à®¯ à®‰à®³à¯à®³à¯€à®Ÿà¯à®•à®³à¯", farmInputsSub: "à®µà®¿à®°à¯à®ªà¯à®ªà®™à¯à®•à®³à¯ˆà®¤à¯ à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®µà¯à®®à¯", assistantLbl: "à®‰à®¤à®µà®¿à®¯à®¾à®³à®°à¯",
Â  Â  Â  Â  chatWelcome: "AgroNity à®•à¯à®•à¯ à®µà®°à®µà¯‡à®±à¯à®•à®¿à®±à¯‹à®®à¯ - à®®à¯à®¤à®²à®¿à®²à¯ à®‰à®³à¯à®¨à¯à®´à¯ˆà®¯à®µà¯à®®à¯.", imgPrevLbl: "à®ªà®Ÿ à®®à¯à®©à¯à®©à¯‹à®Ÿà¯à®Ÿà®®à¯:",
Â  Â  Â  Â  includeLbl: "à®ªà®¤à®¿à®²à®¿à®²à¯ à®šà¯‡à®°à¯à®•à¯à®•à®µà¯à®®à¯", toggleLbl: "à®®à®¾à®±à¯à®±à¯", chipMandi: "à®®à®£à¯à®Ÿà®¿ à®µà®¿à®²à¯ˆ",
Â  Â  Â  Â  chipWeather: "à®µà®¾à®©à®¿à®²à¯ˆ", chipPast: "à®®à¯à®¨à¯à®¤à¯ˆà®¯ à®…à®±à®¿à®•à¯à®•à¯ˆà®•à®³à¯", chipGraph: "à®µà®³à®°à¯à®šà¯à®šà®¿ à®µà®°à¯ˆà®ªà®Ÿà®®à¯",
Â  Â  Â  Â  profitLbl: "à®²à®¾à®ª à®ªà¯‹à®•à¯à®•à¯ (à®®à®¾à®¤à®¨à¯à®¤à¯‹à®±à¯à®®à¯)", last12Lbl: "à®•à®Ÿà®¨à¯à®¤ 12 à®®à®¾à®¤à®™à¯à®•à®³à¯", summaryLbl: "à®šà¯à®°à¯à®•à¯à®•à®®à¯"
Â  Â  },
Â  Â  hi: {
Â  Â  Â  Â  farmInputsLbl: "à¤–à¥‡à¤¤à¥€ à¤‡à¤¨à¤ªà¥à¤Ÿ", farmInputsSub: "à¤µà¤¿à¤•à¤²à¥à¤ª à¤šà¥à¤¨à¥‡à¤‚", assistantLbl: "à¤¸à¤¹à¤¾à¤¯à¤•",
Â  Â  Â  Â  chatWelcome: "AgroNity à¤®à¥‡à¤‚ à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ - à¤ªà¤¹à¤²à¥‡ à¤²à¥‰à¤—à¤¿à¤¨ à¤•à¤°à¥‡à¤‚à¥¤", imgPrevLbl: "à¤šà¤¿à¤¤à¥à¤° à¤ªà¥‚à¤°à¥à¤µà¤¾à¤µà¤²à¥‹à¤•à¤¨:",
Â  Â  Â  Â  includeLbl: "à¤‰à¤¤à¥à¤¤à¤° à¤®à¥‡à¤‚ à¤¶à¤¾à¤®à¤¿à¤² à¤•à¤°à¥‡à¤‚", toggleLbl: "à¤Ÿà¥‰à¤—à¤²", chipMandi: "à¤®à¤‚à¤¡à¥€ à¤­à¤¾à¤µ",
Â  Â  Â  Â  chipWeather: "à¤®à¥Œà¤¸à¤®", chipPast: "à¤ªà¤¿à¤›à¤²à¥€ à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ", chipGraph: "à¤µà¥ƒà¤¦à¥à¤§à¤¿ à¤—à¥à¤°à¤¾à¤«",
Â  Â  Â  Â  profitLbl: "à¤²à¤¾à¤­ à¤ªà¥à¤°à¤µà¥ƒà¤¤à¥à¤¤à¤¿ (à¤®à¤¾à¤¸à¤¿à¤•)", last12Lbl: "à¤ªà¤¿à¤›à¤²à¥‡ 12 à¤®à¤¹à¥€à¤¨à¥‡", summaryLbl: "à¤¸à¤¾à¤°à¤¾à¤‚à¤¶"
Â  Â  },
Â  Â  te: {
Â  Â  Â  Â  farmInputsLbl: "à°ªà°‚à°Ÿ à°‡à°¨à±â€Œà°ªà±à°Ÿà±â€Œà°²à±", farmInputsSub: "à°à°‚à°ªà°¿à°•à°²à°¨à± à°à°‚à°šà±à°•à±‹à°‚à°¡à°¿", assistantLbl: "à°¸à°¹à°¾à°¯à°•à±à°¡à±",
Â  Â  Â  Â  chatWelcome: "AgroNityà°•à°¿ à°¸à±à°µà°¾à°—à°¤à°‚ - à°¦à°¯à°šà±‡à°¸à°¿ à°®à±à°‚à°¦à±à°—à°¾ à°²à°¾à°—à°¿à°¨à± à°…à°µà±à°µà°‚à°¡à°¿.", imgPrevLbl: "à°šà°¿à°¤à±à°° à°ªà±à°°à°¿à°µà±à°¯à±‚:",
Â  Â  Â  Â  includeLbl: "à°¸à°®à°¾à°§à°¾à°¨à°‚à°²à±‹ à°šà±‡à°°à±à°šà°‚à°¡à°¿", toggleLbl: "à°Ÿà°¾à°—à°²à±", chipMandi: "à°®à°‚à°¡à°¿ à°§à°°à°²à±",
Â  Â  Â  Â  chipWeather: "à°µà°¾à°¤à°¾à°µà°°à°£à°‚", chipPast: "à°—à°¤ à°¨à°¿à°µà±‡à°¦à°¿à°•à°²à±", chipGraph: "à°µà±ƒà°¦à±à°§à°¿ à°—à±à°°à°¾à°«à±",
Â  Â  Â  Â  profitLbl: "à°²à°¾à°­ à°Ÿà±à°°à±†à°‚à°¡à± (à°¨à±†à°²à°µà°¾à°°à±€)", last12Lbl: "à°—à°¤ 12 à°¨à±†à°²à°²à±", summaryLbl: "à°¸à°¾à°°à°¾à°‚à°¶à°‚"
Â  Â  },
Â  Â  pa: {
Â  Â  Â  Â  farmInputsLbl: "à¨–à©‡à¨¤à©€à¨¬à¨¾à©œà©€ à¨‡à¨¨à¨ªà©à©±à¨Ÿà¨¸",
Â  Â  Â  Â  farmInputsSub: "à¨µà¨¿à¨•à¨²à¨ª à¨šà©à¨£à©‹",
Â  Â  Â  Â  assistantLbl: "à¨¸à¨¹à¨¾à¨‡à¨•",
Â  Â  Â  Â  chatWelcome: "à¨à¨—à¨°à©‹à¨¨à¨¿à¨Ÿà©€ à¨µà¨¿à©±à¨š à¨¸à©à¨†à¨—à¨¤ à¨¹à©ˆ - à¨•à¨¿à¨°à¨ªà¨¾ à¨•à¨°à¨•à©‡ à¨ªà¨¹à¨¿à¨²à¨¾à¨‚ à¨²à¨¾à¨—à¨‡à¨¨ à¨•à¨°à©‹à¥¤",
Â  Â  Â  Â  imgPrevLbl: "à¨šà¨¿à©±à¨¤à¨° à¨à¨²à¨•:",
Â  Â  Â  Â  includeLbl: "à¨œà¨µà¨¾à¨¬ à¨µà¨¿à©±à¨š à¨¸à¨¼à¨¾à¨®à¨² à¨•à¨°à©‹",
Â  Â  Â  Â  toggleLbl: "à¨Ÿà©Œà¨—à¨²",
Â  Â  Â  Â  chipMandi: "à¨®à©°à¨¡à©€ à¨¦à©‡ à¨°à©‡à¨Ÿ",
Â  Â  Â  Â  chipWeather: "à¨®à©Œà¨¸à¨®",
Â  Â  Â  Â  chipPast: "à¨ªà¨¿à¨›à¨²à©€à¨†à¨‚ à¨°à¨¿à¨ªà©‹à¨°à¨Ÿà¨¾à¨‚",
Â  Â  Â  Â  chipGraph: "à¨µà¨¿à¨•à¨¾à¨¸ à¨—à©à¨°à¨¾à¨«",
Â  Â  Â  Â  profitLbl: "à¨²à¨¾à¨­ à¨¦à¨¾ à¨°à©à¨à¨¾à¨¨ (à¨®à¨¹à©€à¨¨à¨¾à¨µà¨¾à¨°)",
Â  Â  Â  Â  last12Lbl: "à¨ªà¨¿à¨›à¨²à©‡ 12 à¨®à¨¹à©€à¨¨à©‡",
Â  Â  Â  Â  summaryLbl: "à¨¸à©°à¨–à©‡à¨ª",
Â  Â  },
Â  Â  ml: {
Â  Â  Â  Â  farmInputsLbl: "à´•à´¾àµ¼à´·à´¿à´• à´‡àµ»à´ªàµà´Ÿàµà´Ÿàµà´•àµ¾",
Â  Â  Â  Â  farmInputsSub: "à´“à´ªàµà´·à´¨àµà´•àµ¾ à´¤à´¿à´°à´àµà´àµ†à´Ÿàµà´•àµà´•àµà´•",
Â  Â  Â  Â  assistantLbl: "à´…à´¸à´¿à´¸àµà´±àµà´±à´¨àµà´±àµ",
Â  Â  Â  Â  chatWelcome: "à´…à´—àµà´°àµ‹à´¨à´¿à´±àµà´±à´¿à´¯à´¿à´²àµ‡à´•àµà´•àµ à´¸àµà´µà´¾à´—à´¤à´‚ - à´†à´¦àµà´¯à´‚ à´²àµ‹à´—à´¿àµ» à´šàµ†à´¯àµà´¯àµà´•.",
Â  Â  Â  Â  imgPrevLbl: "à´šà´¿à´¤àµà´°à´‚ à´ªàµà´°à´¿à´µàµà´¯àµ‚:",
Â  Â  Â  Â  includeLbl: "à´‰à´¤àµà´¤à´°à´¤àµà´¤à´¿àµ½ à´‰àµ¾à´ªàµà´ªàµ†à´Ÿàµà´¤àµà´¤àµà´•",
Â  Â  Â  Â  toggleLbl: "à´Ÿàµ‹à´—à´¿àµ¾",
Â  Â  Â  Â  chipMandi: "à´®à´£àµà´¡à´¿ à´µà´¿à´²à´•àµ¾",
Â  Â  Â  Â  chipWeather: "à´•à´¾à´²à´¾à´µà´¸àµà´¥",
Â  Â  Â  Â  chipPast: "à´•à´´à´¿à´àµà´ à´±à´¿à´ªàµà´ªàµ‹àµ¼à´Ÿàµà´Ÿàµà´•àµ¾",
Â  Â  Â  Â  chipGraph: "à´µà´³àµ¼à´šàµà´šà´¾ à´—àµà´°à´¾à´«àµ",
Â  Â  Â  Â  profitLbl: "à´²à´¾à´­ à´Ÿàµà´°àµ†àµ»à´¡àµ (à´ªàµà´°à´¤à´¿à´®à´¾à´¸à´‚)",
Â  Â  Â  Â  last12Lbl: "à´•à´´à´¿à´àµà´ 12 à´®à´¾à´¸à´™àµà´™àµ¾",
Â  Â  Â  Â  summaryLbl: "à´¸à´‚à´—àµà´°à´¹à´‚",
Â  Â  }
};

function changeLang() {
Â  Â  const lang = document.getElementById("langSel").value;
Â  Â  const t = translations[lang];
Â  Â  document.getElementById("farmInputsLbl").textContent = t.farmInputsLbl;
Â  Â  document.getElementById("farmInputsSub").textContent = t.farmInputsSub;
Â  Â  document.getElementById("assistantLbl").textContent = t.assistantLbl;
Â  Â  document.getElementById("chatWelcome").textContent = t.chatWelcome;
Â  Â  document.getElementById("imgPrevLbl").textContent = t.imgPrevLbl;
Â  Â  document.getElementById("includeLbl").textContent = t.includeLbl;
Â  Â  document.getElementById("toggleLbl").textContent = t.toggleLbl;
Â  Â  document.getElementById("chipMandi").textContent = t.chipMandi;
Â  Â  document.getElementById("chipWeather").textContent = t.chipWeather;
Â  Â  document.getElementById("chipPast").textContent = t.chipPast;
Â  Â  document.getElementById("chipGraph").textContent = t.chipGraph;
Â  Â  document.getElementById("profitLbl").textContent = t.profitLbl;
Â  Â  document.getElementById("last12Lbl").textContent = t.last12Lbl;
Â  Â  document.getElementById("summaryLbl").textContent = t.summaryLbl;
}

// --- Budget advice section logic ---
const budgetAdviceCard = document.getElementById('budgetAdviceCard');
if (budgetAdviceCard) {
Â  Â  budgetAdviceCard.querySelector("#getBudgetBtn").addEventListener("click", () => {
Â  Â  Â  Â  const crop = budgetAdviceCard.querySelector("#budgetCropInp").value.toLowerCase().trim();
Â  Â  Â  Â  const area = parseFloat(budgetAdviceCard.querySelector("#budgetAreaInp").value);

Â  Â  Â  Â  if (!loggedIn) {
Â  Â  Â  Â  Â  Â  pushMsg('bot', "Please log in to get budget advice.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!crop || isNaN(area) || area <= 0) {
Â  Â  Â  Â  Â  Â  pushMsg('bot', 'Please enter a valid crop name and a positive area.');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  pushMsg('bot', 'Analyzing budget...');

Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  // Remove the "Analyzing..." message
Â  Â  Â  Â  Â  Â  const interimMsg = document.querySelector("#chat .msg.bot:last-child");
Â  Â  Â  Â  Â  Â  if (interimMsg && interimMsg.innerText.includes("Analyzing budget")) {
Â  Â  Â  Â  Â  Â  Â  Â  interimMsg.remove();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let advice = '';
Â  Â  Â  Â  Â  Â  const randomFactor = 0.9 + Math.random() * 0.2; // Adds a random variance
Â  Â  Â  Â  Â  Â  let costPerHectare;

Â  Â  Â  Â  Â  Â  switch(crop) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'paddy':
Â  Â  Â  Â  Â  Â  Â  Â  case 'rice':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  costPerHectare = 75000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'wheat':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  costPerHectare = 86000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'cotton':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  costPerHectare = 160000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  costPerHectare = 100000;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const totalCost = (costPerHectare * area * randomFactor).toFixed(2);
Â  Â  Â  Â  Â  Â  advice = `Based on your inputs, the estimated budget for cultivating **${crop}** on **${area} hectares** is approximately **â‚¹${totalCost}**.`;
Â  Â  Â  Â  Â  Â  pushMsg('bot', advice);
Â  Â  Â  Â  }, 1500); // Wait 1.5 seconds to simulate a real-time process
Â  Â  });
}

// --- Image analysis logic ---
const fileImg = document.getElementById('fileImg');
fileImg.addEventListener('change', async (event) => {
Â  Â  const file = event.target.files[0];
Â  Â  if (!file) return;

Â  Â  if (!loggedIn) {
Â  Â  Â  Â  pushMsg('bot', "Please log in to upload images for analysis.");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const reader = new FileReader();
Â  Â  reader.onload = function(e) {
Â  Â  Â  Â  pushMsg('user', '', true, e.target.result);
Â  Â  };
Â  Â  reader.readAsDataURL(file);

Â  Â  try {
Â  Â  Â  Â  pushMsg('bot', "Analyzing image...");
Â  Â  Â  Â  const response = await fetch('/analyze_image', {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  body: JSON.stringify({ filename: file.name })
Â  Â  Â  Â  });

Â  Â  Â  Â  // This removes the "Analyzing image..." message before showing the result.
Â  Â  Â  Â  const interim = document.querySelector("#chat .msg.bot:last-child");
Â  Â  Â  Â  if (interim && interim.textContent.includes("Analyzing")) interim.remove();

Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  if (data.status === 'success') {
Â  Â  Â  Â  Â  Â  const diseasePrediction = diseaseData[data.crop.toLowerCase()] || diseaseData.default;

Â  Â  Â  Â  Â  Â  const resultMessage = `
**Diagnosis Report**,
\nCrop Name: **${data.crop}**,
  Average Production: **${data.avg_production}**,
  Mandi Price: **â‚¹${data.mandi_price} per kg**,
\n${diseasePrediction.join('\n')}
Â  Â  Â  Â  Â  Â  Â  Â `;
Â  Â  Â  Â  Â  Â  pushMsg('bot', resultMessage);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  pushMsg('bot', `âš ï¸ Sorry, there was an issue with the analysis. ${data.message}`);
Â  Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  Â  const interim = document.querySelector("#chat .msg.bot:last-child");
Â  Â  Â  Â  if (interim && interim.textContent.includes("Analyzing")) interim.remove();
Â  Â  Â  Â  pushMsg('bot', 'âš ï¸ Sorry, there was an error analyzing the image. Please try again.');
Â  Â  }
});

// --- Submit handler for feasibility analysis ---
document.getElementById("submitBtn").addEventListener("click", async () => {
Â  Â  const crop = document.getElementById("cropSel").value;
Â  Â  const district = document.getElementById("distSel").value;
Â  Â  const area = document.getElementById("landInp").value;
Â  Â  const soil = document.getElementById("soilSel").value;

Â  Â  const userText = `Analyze for Crop: ${crop}, District: ${district}, Area: ${area} acres, Soil: ${soil}`;
Â  Â  pushMsg("user", userText);
Â  Â  pushMsg("bot", "Analyzing your request...");

Â  Â  try {
Â  Â  Â  Â  const response = await fetch("/analyze", {
Â  Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  Â  Â  body: JSON.stringify({ crop, district, area, soil })
Â  Â  Â  Â  });
Â  Â  Â  Â  const result = await response.json();

Â  Â  Â  Â  // remove interim message
Â  Â  Â  Â  const interim = document.querySelector("#chat .msg.bot:last-child");
Â  Â  Â  Â  if (interim && interim.textContent.includes("Analyzing")) interim.remove();

Â  Â  Â  Â  if (result.feasible) {
Â  Â  Â  Â  Â  Â  const reply = `
âœ… Feasibility Analysis: **FEASIBLE!**
Probability: ${result.probability.toFixed(2)}
Expected Yield: ${result.expected_yield_tpha.toFixed(2)} tons/ha
Yield %: ${result.yield_percentage.toFixed(2)}%
Mandi Price: Rs. ${result.mandi_price_rs_per_quintal.toFixed(2)} /qtl
Profit: Rs. ${result.profit_rs.toFixed(2)}
Revenue: Rs. ${result.total_revenue_rs.toFixed(2)}
Revenue (1yr): Rs. ${result.revenue_1yr_rs.toFixed(2)}
Revenue (2yr): Rs. ${result.revenue_2yr_rs.toFixed(2)}
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  pushMsg("bot", reply);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  let reply = "âŒ Feasibility Analysis: **NOT FEASIBLE.**\nReasons:\n";
Â  Â  Â  Â  Â  Â  result.reasons.forEach(r => reply += `- ${r}\n`);
Â  Â  Â  Â  Â  Â  pushMsg("bot", reply);
Â  Â  Â  Â  }
Â  Â  } catch (err) {
Â  Â  Â  Â  pushMsg("bot", "âš ï¸ Error: Could not connect to backend.");
Â  Â  }
});
function reply(q) {
Â  const qLower = q.toLowerCase();
Â  const pin = "141001"; // Default pincode for demonstration
Â  const crop = document.getElementById('cropSel').value; // Get the selected crop from the dropdown
Â  const d = DATA[pin];
Â  if (!d) {
Â  Â  pushMsg('bot', 'No data for this pincode.');
Â  Â  return;
Â  }

Â  let ans = '';

Â  const steps = {
Â  Â  "Paddy": `**ğŸŒ¾ Easy Steps for Paddy (Rice) Cultivation**<br>- Prepare land: Plough, level, and add cow dung/compost (5â€“6 cartloads per acre).<br>- Seed: Use good quality seed (10â€“12 kg per acre).<br>- Nursery: Grow seedlings for 20â€“25 days.<br>- Transplanting: Plant at 20 Ã— 15 cm spacing.<br>- Water: Keep 2â€“3 inches standing water; drain occasionally.<br>- Fertilizer: Urea/DAP/MOP in 3 stages â€“ planting, tillering, flowering.<br>- Weeding & pests: Remove weeds early; neem oil for pests.<br>- Harvest & store: Cut when grains turn golden, dry and store safely.`,
Â  Â  "Wheat": `**ğŸŒ¾ Easy Steps for Wheat Cultivation**<br>- Prepare land: Plough, level, and add FYM/compost (4â€“5 cartloads per acre).<br>- Seed: Use 40â€“50 kg good quality seed per acre.<br>- Sowing: Line sowing at 22â€“25 cm spacing.<br>- Water: Irrigate at critical stages (crown root, tillering, flowering).<br>- Fertilizer: Urea/DAP in 3 splits â€“ sowing, tillering, flowering.<br>- Weeding & pests: Remove weeds early; spray if rust/aphids appear.<br>- Harvest & store: Harvest when grains are hard and golden, dry well before storage.`,
Â  Â  "Maize": `**ğŸŒ½ Easy Steps for Maize Cultivation**<br>- Prepare land: Plough to a fine tilth; add 10â€“15 tons of manure/compost per hectare.<br>- Seed & Sowing: Use 17â€“20 kg seed per hectare; plant in rows 60â€“75 cm apart.<br>- Water: Ensure consistent moisture, especially during flowering, but avoid waterlogging.<br>- Fertilizer: Apply a basal dose, with remaining nitrogen split into doses at the knee-high stage and tasseling.<br>- Weeding & Pests: Weed early and consider earthing up for stability.<br>- Harvest & Store: Harvest when kernels are firm; dry cobs and store in a cool, dry place.`,
    "Rice": `**ğŸŒ¾ Easy Steps for Rice (Paddy) Cultivation**<br>- Prepare land: Plough and puddle the land, often under flooded conditions.<br>- Seed & Nursery: Test seeds by floating; sow in a nursery for 25â€“30 days before transplanting.<br>- Transplanting: Plant seedlings from the nursery to the main field with a specific spacing, like 20 x 15 cm.<br>- Water: Keep a standing water level of 2â€“3 inches, draining before harvest.<br>- Fertilizer: Apply Urea, DAP, and MOP in multiple applications timed with the crop's growth.<br>- Weeding & Pests: Control weeds by puddling and manual removal; manage pests with IPM techniques.<br>- Harvest & Store: Harvest when grains are golden; dry thoroughly before storing.`,
    "Tomato": `**ğŸ… Easy Steps for Tomato Cultivation**<br>- Prepare land: Add FYM/compost before planting.<br>- Seed: Use 40â€“50 g hybrid seeds per acre.<br>- Nursery: Raise seedlings for 25â€“30 days.<br>- Transplanting: Plant at 60 Ã— 45 cm spacing.<br>- Water: Regular irrigation, drip is best.<br>- Fertilizer: NPK in splits; extra potassium at fruiting.<br>- Weeding & pests: Stake plants; use neem oil/organic sprays for fruit borer.<br>- Harvest: Pick when fruits turn red and firm.`,
Â  Â  "Cotton": `**ğŸŒ± Easy Steps for Cotton Cultivation**<br>- Prepare land: Deep ploughing, add FYM (5 tons per acre).<br>- Seed: Use 1â€“1.5 kg certified Bt/non-Bt cotton seed per acre.<br>- Sowing: Spacing 90 Ã— 60 cm.<br>- Water: Needs 6â€“8 irrigations; drip is efficient.<br>- Fertilizer: Balanced NPK in 3 splits.<br>- Weeding & pests: Watch for bollworm, whitefly; spray neem oil or recommended pesticides.<br>- Harvest: Pick clean, dry cotton bolls.`,
Â  Â  "Soybean": `**ğŸŒ¿ Easy Steps for Soybean Cultivation**<br>- Prepare land: Add FYM/compost (5 tons per acre).<br>- Seed: Use 25â€“30 kg certified seeds per acre.<br>- Sowing: Line sowing, 30 Ã— 10 cm spacing.<br>- Water: Needs 4â€“5 irrigations, critical at flowering & pod filling.<br>- Fertilizer: Apply DAP at sowing; top-dress urea at flowering.<br>- Weeding & pests: Keep weed-free for first 40 days; control caterpillars/rust.<br>- Harvest: Cut when pods turn yellow-brown.`,
Â  Â  "Mustard": `**ğŸŒ¼ Easy Steps for Mustard Cultivation**<br>- Prepare land: Fine tilth, add FYM/compost (4 cartloads per acre).<br>- Seed: Use 2â€“3 kg seed per acre.<br>- Sowing: Line sowing, 30 Ã— 10 cm spacing.<br>- Water: 2â€“3 irrigations, critical at flowering & pod filling.<br>- Fertilizer: Urea/DAP at sowing; top-dress after 25 days.<br>- Weeding & pests: Early weeding; watch for aphids, spray neem oil if needed.<br>- Harvest: Cut when pods turn yellow, dry and thresh.`,
Â  Â  "Sugarcane": `**ğŸ¬ Easy Steps for Sugarcane Cultivation**<br>- Prepare land: Deep plough, level field, add FYM/compost (8â€“10 tons per acre).<br>- Seed: Use healthy sugarcane setts (about 1000â€“1200 per acre).<br>- Sowing: Plant setts in furrows at 45 Ã— 30 cm spacing.<br>- Water: Regular irrigation, especially during tillering and grand growth.<br>- Fertilizer: Apply NPK in 3â€“4 splits; extra nitrogen during growth stage.<br>- Weeding & pests: Remove weeds early; monitor for borers and aphids, spray neem oil if needed.<br>- Harvest: Harvest after 10â€“12 months when stalks are mature and juicy.`,
Â  Â  "default": "Sorry, I don't have detailed cultivation steps for this crop yet."
Â  };
Â  
Â  const links = {
Â  Â  "Paddy": `<br>- ğŸ‘‰ Buy manure: <a href="https://www.ugaoo.com/collections/manures-fertilizers" target="_blank">Ugaoo</a><br>- ğŸ‘‰ Certified seeds: <a href="https://www.sahajaseeds.com/" target="_blank">Sahaja Seeds</a><br>- ğŸ‘‰ Irrigation video: <a href="https://www.youtube.com/watch?v=ZxJRmENdzV8" target="_blank">YouTube</a><br>- ğŸ‘‰ Neem oil: <a href="https://www.ugaoo.com/products/neem-oil-for-plants" target="_blank">Ugaoo</a>`,
Â  Â  "Wheat": `<br>- ğŸ‘‰ Buy manure: <a href="https://www.ugaoo.com/collections/manures-fertilizers" target="_blank">Ugaoo</a><br>- ğŸ‘‰ Certified seeds: <a href="https://haryanaseeds.gov.in/" target="_blank">Haryana Seeds</a><br>- ğŸ‘‰ Irrigation guide: <a href="https://www.youtube.com/watch?v=ZxJRmENdzV8" target="_blank">YouTube</a>`,
    "Maize": `<br>- ğŸ‘‰ Buy manure: <a href="https://katyayanikrishidirect.com/collections/npk-fertilizer-for-crops" target="_blank">Katyayani Krishi Direct</a><br>- ğŸ‘‰ Certified seeds: <a href="https://agriplexindia.com/collections/maize" target="_blank">Agriplex</a><br>- ğŸ‘‰ Irrigation video: <a href="https://www.youtube.com/playlist?list=PL59NeXPjV62R3Fb3OoQ2G8l3pzU4fHs-D" target="_blank">YouTube Playlist</a><br>- ğŸ‘‰ Neem oil: <a href="https://www.ugaoo.com/products/neem-oil-for-plants" target="_blank">Ugaoo</a>`,
    "Paddy": `<br>- ğŸ‘‰ Buy manure: <a href="https://www.bighaat.com/collections/micronutrients" target="_blank">BigHaat</a><br>- ğŸ‘‰ Certified seeds: <a href="https://krushidukan.bharatagri.com/en/collections/paddy-seeds-online" target="_blank">BharatAgri Krushi Dukan</a><br>- ğŸ‘‰ Irrigation video: <a href="https://www.youtube.com/watch?v=kT1R7Hkps5M" target="_blank">YouTube</a><br>- ğŸ‘‰ Neem oil: <a href="https://www.ugaoo.com/products/neem-oil-for-plants" target="_blank">Ugaoo</a>`,
    "Tomato": `<br>- ğŸ‘‰ Organic manure: <a href="https://www.ugaoo.com/collections/manures-fertilizers" target="_blank">Ugaoo</a><br>- ğŸ‘‰ Tomato seeds: <a href="https://www.sahajaseeds.com/" target="_blank">Sahaja Seeds</a><br>- ğŸ‘‰ Drip irrigation demo: <a href="https://www.youtube.com/watch?v=SclaUd90HAc" target="_blank">YouTube</a>`,
Â  Â  "Cotton": `<br>- ğŸ‘‰ Cotton seeds info: <a href="https://nafed-india.com/" target="_blank">Nafed</a><br>- ğŸ‘‰ Neem oil: <a href="https://www.ugaoo.com/products/neem-oil-for-plants" target="_blank">Ugaoo</a>`,
Â  Â  "Soybean": `<br>- ğŸ‘‰ Soybean seeds info: <a href="https://nafed-india.com/" target="_blank">Nafed</a>`,
Â  Â  "Mustard": `<br>- ğŸ‘‰ Mustard seeds: <a href="https://agribegri.com/" target="_blank">AgriBegri</a>`,
Â  Â  "Sugarcane": `<br>- ğŸ‘‰ Buy manure: <a href="https://www.ugaoo.com/collections/manures-fertilizers" target="_blank">Ugaoo</a><br>- ğŸ‘‰ Sugarcane setts: <a href="https://nafed-india.com/" target="_blank">Nafed</a><br>- ğŸ‘‰ Irrigation guide: <a href="https://www.youtube.com/watch?v=SclaUd90HAc" target="_blank">YouTube</a>`
Â  };

Â  const selectedCrop = (crop === 'Rice') ? 'Paddy' : crop; 

Â  if ((qLower.includes('harvest') || qLower.includes('cultivation') || qLower.includes('how to grow') || qLower.includes('guide')) && steps[selectedCrop]) {
Â  Â  ans = steps[selectedCrop] + (links[selectedCrop] || '');
Â  } else if (qLower.includes('fertilizer')) {
Â  Â  ans = `Fertilizer recommendation: ${d.rules.fertilizer}`;
Â  } else if (qLower.includes('manure')) {
Â  Â  ans = `Manure recommendation: ${d.rules.manure}`;
Â  } else if (qLower.includes('pesticide')) {
Â  Â  ans = `Pesticide recommendation: ${d.rules.pesticide}`;
Â  } else {
Â  Â  ans = `${d.district} - Crop:${d.rules.crop} - Fertilizer:${d.rules.fertilizer} - Manure:${d.rules.manure} - Pesticide:${d.rules.pesticide} - Water:${d.rules.water}`;
Â  }

Â  if (chipOn('Mandi Prices')) ans += `<br>Mandi: ${d.mandi.price}${d.mandi.unit} (${d.mandi.date})`;
Â  if (chipOn('Weather')) ans += `<br>Weather: ${d.weather.now} | Forecast: ${d.weather.forecast}`;
Â  if (chipOn('Past Reports')) ans += `<br>Last crop: ${d.past.last_crop} | Yield: ${d.past.yield_qtl_per_acre} qtl/acre`;
Â  if (chipOn('Growth Graph')) {
Â  Â  ans += `<br>Graph updated.`;
Â  Â  updateChartForPin(pin);
Â  }
Â  pushMsg('bot', ans);
Â  distSummary.innerHTML = `<strong style="color:var(--accent)">${d.district}</strong><div>Crop:${d.rules.crop}</div><div>Fertilizer:${d.rules.fertilizer}</div><div>Manure:${d.rules.manure}</div><div>Pesticide:${d.rules.pesticide}</div><div>Weather:${d.weather.now}</div>`;
}
</script>
</body>
</html>
